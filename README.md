# DevTUI
<!-- START_SECTION:BADGES_SECTION -->
<a href="docs/img/badges.svg"><img src="docs/img/badges.svg" alt="Project Badges" title="Generated by badges.sh from github.com/cdvelop/devscripts"></a>
<!-- END_SECTION:BADGES_SECTION -->

Interactive Terminal User Interface library for Go applications development (principal tui in [**GoDEV** App](https://github.com/cdvelop/godev))

## Features

- Tab-based interface organization
- Editable and non-editable fields with real-time validation
- Keyboard navigation (Tab, Shift+Tab, Left/Right arrows, Enter, Esc)
- Field validation and change callbacks
- Message system with unique timestamps and types (Success, Error, Warning, Info)
- Real-time content updates through channel-based messaging
- Customizable styles and colors
- Auto-detection of message types
- Viewport-based scrolling content area

![devtui](tui.jpg)

## Core Architecture

### DevTUI Structure
- **DevTUI**: Main TUI instance that manages tabs, keyboard input, and viewport
- **tabSection**: Individual tabs containing fields and message content  
- **field**: Input fields with validation, editing capabilities, and change handlers
- **tabContent**: Messages with unique IDs, timestamps, and type classification

### Message System
Every action generates a `tabContent` message with:
- **Unique ID**: Unix timestamp-based identifier for message tracking
- **Content**: The actual message text
- **Type**: Auto-detected or explicit (Success, Error, Warning, Info)
- **tabSection**: Reference to the tab that generated the message

## Basic Usage

```go
package main

import (
	"fmt"
	"sync"
	"github.com/cdvelop/devtui"
)

func main() {
	// Configuration
	config := &devtui.TuiConfig{
		AppName:       "MyApp",
		TabIndexStart: 0,                 // Start with first tab
		ExitChan:      make(chan bool),   // Channel for clean shutdown
		Color: &devtui.ColorStyle{        // Optional custom colors
			Foreground: "#F4F4F4",
			Background: "#000000", 
			Highlight:  "#FF6600",
			Lowlight:   "#666666",
		},
		LogToFile: func(messages ...any) {
			fmt.Println(append([]any{"DevTUI Log:"}, messages...)...)
		},
	}

	// Create TUI instance
	tui := devtui.NewTUI(config)

	// Create tab with chained API
	tui.NewTabSection("Main", "Press Enter to edit fields").
		NewField("Username", "", true, func(newValue any) (string, error) {
			username := newValue.(string)
			if len(username) < 3 {
				return "", fmt.Errorf("username must be at least 3 characters")
			}
			return fmt.Sprintf("Username set to: %s", username), nil
		}).
		NewField("Port", "8080", true, func(newValue any) (string, error) {
			// Port validation example
			return fmt.Sprintf("Port updated: %s", newValue), nil
		}).
		NewField("Deploy", "Click to deploy", false, func(newValue any) (string, error) {
			// Non-editable action button
			return "Deployment started successfully", nil
		})

	// Start TUI with proper synchronization
	var wg sync.WaitGroup
	wg.Add(1)
	go tui.Start(&wg)
	wg.Wait()

	fmt.Println("Application finished")
}
```

# DevTUI
<!-- START_SECTION:BADGES_SECTION -->
<a href="docs/img/badges.svg"><img src="docs/img/badges.svg" alt="Project Badges" title="Generated by badges.sh from github.com/cdvelop/devscripts"></a>
<!-- END_SECTION:BADGES_SECTION -->

Interactive Terminal User Interface library for Go applications development (principal tui in [**GoDEV** App](https://github.com/cdvelop/godev))

## Features

- Tab-based interface organization
- Editable and non-editable fields with real-time validation
- Keyboard navigation (Tab, Shift+Tab, Left/Right arrows, Enter, Esc)
- Field validation and change callbacks
- Message system with unique timestamps and types (Success, Error, Warning, Info)
- Real-time content updates through channel-based messaging
- Customizable styles and colors
- Auto-detection of message types
- Viewport-based scrolling content area

![devtui](tui.jpg)

## Core Architecture

### DevTUI Structure
- **DevTUI**: Main TUI instance that manages tabs, keyboard input, and viewport
- **tabSection**: Individual tabs containing fields and message content  
- **field**: Input fields with validation, editing capabilities, and change handlers
- **tabContent**: Messages with unique IDs, timestamps, and type classification

### Message System
Every action generates a `tabContent` message with:
- **Unique ID**: Unix timestamp-based identifier for message tracking
- **Content**: The actual message text
- **Type**: Auto-detected or explicit (Success, Error, Warning, Info)
- **tabSection**: Reference to the tab that generated the message

## Basic Usage

```go
package main

import (
	"fmt"
	"sync"
	"github.com/cdvelop/devtui"
)

func main() {
	// Configuration
	config := &devtui.TuiConfig{
		AppName:       "MyApp",
		TabIndexStart: 0,                 // Start with first tab
		ExitChan:      make(chan bool),   // Channel for clean shutdown
		Color: &devtui.ColorStyle{        // Optional custom colors
			Foreground: "#F4F4F4",
			Background: "#000000", 
			Highlight:  "#FF6600",
			Lowlight:   "#666666",
		},
		LogToFile: func(messages ...any) {
			fmt.Println(append([]any{"DevTUI Log:"}, messages...)...)
		},
	}

	// Create TUI instance
	tui := devtui.NewTUI(config)

	// Create tab with chained API
	tui.NewTabSection("Main", "Press Enter to edit fields").
		NewField("Username", "", true, func(newValue any) (string, error) {
			username := newValue.(string)
			if len(username) < 3 {
				return "", fmt.Errorf("username must be at least 3 characters")
			}
			return fmt.Sprintf("Username set to: %s", username), nil
		}).
		NewField("Port", "8080", true, func(newValue any) (string, error) {
			// Port validation example
			return fmt.Sprintf("Port updated: %s", newValue), nil
		}).
		NewField("Deploy", "Click to deploy", false, func(newValue any) (string, error) {
			// Non-editable action button
			return "Deployment started successfully", nil
		})

	// Start TUI with proper synchronization
	var wg sync.WaitGroup
	wg.Add(1)
	go tui.Start(&wg)
	wg.Wait()

	fmt.Println("Application finished")
}
```

## API Reference

### DevTUI Creation
- `NewTUI(config *TuiConfig) *DevTUI`: Create new TUI instance
- `DefaultTUIForTest() *DevTUI`: Create TUI with default testing configuration

### Tab Management
- `NewTabSection(name, description string) *tabSection`: Create new tab with chained API
- `AddTabSections(tabs ...*tabSection)`: Add multiple tabs to TUI
- `GetActiveTab() *tabSection`: Get currently active tab
- `NextTab()` / `PreviousTab()`: Navigate between tabs

### Field Management (Chained API)
```go
tui.NewTabSection("TabName", "Description").
	NewField(label, value, editable, changeFunc).
	NewField(label, value, editable, changeFunc)
```

#### Field Parameters:
- **label**: Display name for the field
- **value**: Initial/current field value  
- **editable**: `true` for input fields, `false` for action buttons
- **changeFunc**: `func(newValue any) (string, error)` - validation and processing callback

#### Field Change Function Signature:
```go
func(newValue any) (string, error) {
	// newValue contains the user input (string for editable fields, original value for buttons)
	
	// Validation logic here
	if someValidation {
		return "", fmt.Errorf("validation failed: reason")
	}
	
	// Processing logic here
	result := processValue(newValue)
	
	// Return success message (will appear in message area)
	return fmt.Sprintf("Operation successful: %v", result), nil
}
```

### Message System
Messages are automatically generated from field operations and displayed in the viewport:

#### Message Types (Auto-detected):
- **Error**: Contains error keywords ("error", "failed", "fail", etc.) - Red color
- **Success**: Contains success keywords ("ok", "success", "complete", etc.) - Green color  
- **Warning**: Contains warning keywords ("warn", "alert", "caution", etc.) - Yellow color
- **Info**: Default type for other messages - Default color

#### Message Structure:
```go
type tabContent struct {
	id         string      // Unix timestamp-based unique identifier
	content    string      // The actual message text
	msgType    MessageType // Auto-detected message type
	tabSection *tabSection // Reference to originating tab
}
```

### Keyboard Navigation
- **Tab**: Move to next field
- **Shift+Tab**: Move to previous field  
- **Left/Right Arrows**: Navigate between tabs
- **Enter**: Edit field (editable) or trigger action (non-editable)
- **Escape**: Cancel editing, return to navigation mode
- **Ctrl+C**: Exit application
- **Space**: Input space character in edit mode

### Configuration
```go
type TuiConfig struct {
	AppName       string                    // Application title
	TabIndexStart int                       // Initial tab index (0-based)
	ExitChan      chan bool                 // Channel for shutdown coordination
	Color         *ColorStyle               // Optional color customization
	LogToFile     func(messages ...any)     // Optional logging function
}

type ColorStyle struct {
	Foreground string // Text color (hex format)
	Background string // Background color (hex format) 
	Highlight  string // Highlight color (hex format)
	Lowlight   string // Lowlight color (hex format)
}
```

## Advanced Examples

### Field Validation with Complex Logic
```go
tui.NewTabSection("Server", "Server configuration").
	NewField("Host", "localhost", true, func(newValue any) (string, error) {
		host := strings.TrimSpace(newValue.(string))
		if host == "" {
			return "", fmt.Errorf("host cannot be empty")
		}
		if !isValidHost(host) {
			return "", fmt.Errorf("invalid host format")
		}
		return fmt.Sprintf("Host configured: %s", host), nil
	}).
	NewField("Port", "8080", true, func(newValue any) (string, error) {
		portStr := newValue.(string)
		port, err := strconv.Atoi(portStr)
		if err != nil {
			return "", fmt.Errorf("port must be a number")
		}
		if port < 1 || port > 65535 {
			return "", fmt.Errorf("port must be between 1 and 65535")
		}
		return fmt.Sprintf("Port set to: %d", port), nil
	})
```

### Non-editable Action Fields
```go
tui.NewTabSection("Actions", "Available operations").
	NewField("Build Project", "Press Enter to build", false, func(newValue any) (string, error) {
		// Long-running operation
		err := buildProject()
		if err != nil {
			return "", fmt.Errorf("build failed: %v", err)
		}
		return "Build completed successfully", nil
	}).
	NewField("Run Tests", "Execute test suite", false, func(newValue any) (string, error) {
		passed, total := runTests()
		return fmt.Sprintf("Tests completed: %d/%d passed", passed, total), nil
	})
```

### Multiple Tabs with Different Purposes
```go
// Configuration tab
tui.NewTabSection("Config", "Application settings").
	NewField("Database URL", "", true, validateDatabaseURL).
	NewField("API Key", "", true, validateAPIKey).
	
// Monitoring tab  
NewTabSection("Monitor", "System status").
	NewField("Check Health", "Run health check", false, checkSystemHealth).
	NewField("View Logs", "Open log viewer", false, openLogViewer)
```

## Current Limitations

### Synchronous Operations
**Current behavior**: All field `changeFunc` operations execute synchronously, blocking the UI during long-running tasks.

**Impact**: 
- UI freezes during file operations, network calls, or complex processing
- No visual feedback for ongoing operations
- Poor user experience for time-consuming tasks

**Workaround**: Keep change functions lightweight and fast. Defer heavy operations to background goroutines with separate result handling.

### Planned Enhancements
- **Async Field Operations**: Support for long-running operations with progress indicators
- **Loading States**: Visual spinners and progress updates during field processing  
- **Cancellable Operations**: Ability to cancel in-progress field operations
- **Better Error Recovery**: Enhanced error handling with retry mechanisms

## Dependencies

- [Charmbracelet/bubbletea](https://github.com/charmbracelet/bubbletea)
- [Charmbracelet/lipgloss](https://github.com/charmbracelet/lipgloss)
